{% extends 'game/base.html' %}

{% block content %}
<h1>{{ photo.title }}</h1>

<!-- Категория и теги -->
<div class="photo-meta">
    {% if photo.category %}
    <span class="category-badge">
        {{ photo.category.name }}
    </span>
    {% endif %}
    
    {% if photo.tags.all %}
        {% for tag in photo.tags.all %}
        <span class="tag-badge">
            {{ tag.name }}
        </span>
        {% endfor %}
    {% endif %}
</div>

<img src="{{ photo.image.url }}" 
     alt="{{ photo.title }}" 
     class="photo-image"
     onclick="openImageModal('{{ photo.image.url }}', '{{ photo.title }}')"
     style="cursor: pointer;">

<!-- Статистика и лайки -->
<div class="stats-box">
    <div class="stats-flex">
        <div class="stat-item">
            <strong>{{ photo.likes }}</strong> лайков
        </div>
        <div class="stat-item">
            <strong>{{ photo.views }}</strong> просмотров
        </div>
    </div>
    
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message {% if message.tags == 'success' %}message-success{% else %}message-warning{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <form method="post" action="{% url 'like_photo' photo.id %}" class="like-form">
        {% csrf_token %}
        <button type="submit" class="button like-button">
            Поставить лайк
        </button>
    </form>
</div>

<!-- Комментарии к этой фотографии -->
<div class="comments-section">
    <h3>Комментарии ({{ photo_reviews.count }})</h3>
    
    <!-- Форма добавления комментария -->
    <div class="comment-form-box">
        <h4>Оставить комментарий</h4>
        <form method="post">
            {% csrf_token %}
            
            <div class="form-field">
                <label>{{ form.author_name.label }}</label>
                {{ form.author_name }}
            </div>
            
            <div class="form-field">
                <label>{{ form.email.label }}</label>
                {{ form.email }}
            </div>
            
            <div class="form-field">
                <label>{{ form.rating.label }}</label>
                {{ form.rating }}
            </div>
            
            <div class="form-field">
                <label>{{ form.text.label }}</label>
                {{ form.text }}
            </div>
            
            <button type="submit" class="button">Отправить комментарий</button>
        </form>
    </div>
    
    <!-- Список комментариев -->
    {% if photo_reviews %}
        {% for review in photo_reviews %}
        <div class="comment-card">
            <div class="comment-header">
                <strong class="comment-author">{{ review.author_name }}</strong>
                <span class="comment-rating">
                    {{ review.rating }}/5
                </span>
            </div>
            <p class="comment-text">{{ review.text }}</p>
            <small class="comment-date">{{ review.created_at|date:"d.m.Y H:i" }}</small>
        </div>
        {% endfor %}
    {% else %}
        <p class="no-comments">Пока нет комментариев. Будьте первым!</p>
    {% endif %}
</div>

<a href="{% url 'home' %}" class="button">Назад к галерее</a>
{% endblock %}