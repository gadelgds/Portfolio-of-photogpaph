╔═══════════════════════════════════════════════════════════════════════════╗
║                    СХЕМА РАБОТЫ СИСТЕМЫ ОТЗЫВОВ                           ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────┐
│  ЭТАП 1: ПОЛЬЗОВАТЕЛЬ ОТКРЫВАЕТ СТРАНИЦУ ОТЗЫВОВ                        │
└─────────────────────────────────────────────────────────────────────────┘

    Браузер                    Django                     База данных
       │                          │                             │
       │  GET /reviews/           │                             │
       ├─────────────────────────>│                             │
       │                          │                             │
       │                          │  SELECT * FROM review       │
       │                          │  WHERE is_approved=True     │
       │                          ├────────────────────────────>│
       │                          │                             │
       │                          │  [список отзывов]           │
       │                          │<────────────────────────────┤
       │                          │                             │
       │  HTML страница           │                             │
       │  (отзывы + форма)        │                             │
       │<─────────────────────────┤                             │
       │                          │                             │


┌─────────────────────────────────────────────────────────────────────────┐
│  ЭТАП 2: ПОЛЬЗОВАТЕЛЬ ОТПРАВЛЯЕТ ОТЗЫВ                                  │
└─────────────────────────────────────────────────────────────────────────┘

    Браузер                    Django                     База данных
       │                          │                             │
       │  POST /reviews/          │                             │
       │  (имя, email, оценка,    │                             │
       │   текст отзыва)          │                             │
       ├─────────────────────────>│                             │
       │                          │                             │
       │                          │  1. Проверка данных         │
       │                          │     (form.is_valid())       │
       │                          │                             │
       │                          │  2. INSERT INTO review      │
       │                          │     VALUES (...)            │
       │                          │     is_approved = False     │
       │                          ├────────────────────────────>│
       │                          │                             │
       │                          │  OK                         │
       │                          │<────────────────────────────┤
       │                          │                             │
       │  Redirect /reviews/      │                             │
       │  + сообщение "Спасибо!"  │                             │
       │<─────────────────────────┤                             │
       │                          │                             │


┌─────────────────────────────────────────────────────────────────────────┐
│  ЭТАП 3: МОДЕРАТОР ОДОБРЯЕТ ОТЗЫВ                                       │
└─────────────────────────────────────────────────────────────────────────┘

    Админка                    Django                     База данных
       │                          │                             │
       │  GET /admin/game/review/ │                             │
       ├─────────────────────────>│                             │
       │                          │                             │
       │                          │  SELECT * FROM review       │
       │                          ├────────────────────────────>│
       │                          │                             │
       │  [список всех отзывов]   │  [все отзывы]               │
       │<─────────────────────────┤<────────────────────────────┤
       │                          │                             │
       │  POST (одобрить отзыв)   │                             │
       ├─────────────────────────>│                             │
       │                          │                             │
       │                          │  UPDATE review              │
       │                          │  SET is_approved = True     │
       │                          │  WHERE id = X               │
       │                          ├────────────────────────────>│
       │                          │                             │
       │  Успешно сохранено       │  OK                         │
       │<─────────────────────────┤<────────────────────────────┤
       │                          │                             │


╔═══════════════════════════════════════════════════════════════════════════╗
║                         СТРУКТУРА ФАЙЛОВ                                  ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌──────────────────┐
│   models.py      │  ← Описание структуры данных (что хранить)
│                  │
│  class Review:   │
│    author_name   │
│    email         │
│    rating        │
│    text          │
│    created_at    │
│    is_approved   │
└────────┬─────────┘
         │
         │ Миграции (makemigrations + migrate)
         ↓
┌──────────────────┐
│  База данных     │  ← Таблица game_review
│  (db.sqlite3)    │
└──────────────────┘


┌──────────────────┐
│    forms.py      │  ← Создание и проверка форм
│                  │
│  class           │
│  ReviewForm:     │
│    fields        │
│    widgets       │
│    labels        │
└────────┬─────────┘
         │
         │ Используется в
         ↓
┌──────────────────┐
│    views.py      │  ← Логика обработки запросов
│                  │
│  def reviews():  │
│    if POST:      │
│      save()      │
│    else:         │
│      show()      │
└────────┬─────────┘
         │
         │ Вызывается из
         ↓
┌──────────────────┐
│    urls.py       │  ← Маршрутизация URL
│                  │
│  /reviews/       │
│    → reviews()   │
└────────┬─────────┘
         │
         │ Отображается через
         ↓
┌──────────────────┐
│  reviews.html    │  ← HTML шаблон (что видит пользователь)
│                  │
│  - Список        │
│    отзывов       │
│  - Форма для     │
│    добавления    │
└──────────────────┘


╔═══════════════════════════════════════════════════════════════════════════╗
║                      ПОТОК ДАННЫХ (DATA FLOW)                             ║
╚═══════════════════════════════════════════════════════════════════════════╝

Пользователь заполняет форму
         │
         ↓
    ReviewForm проверяет данные
         │
         ↓
    views.py обрабатывает
         │
         ↓
    Модель Review создает объект
         │
         ↓
    Django ORM генерирует SQL
         │
         ↓
    Сохранение в db.sqlite3
         │
         ↓
    Модератор одобряет в админке
         │
         ↓
    is_approved = True
         │
         ↓
    Отзыв появляется на сайте


╔═══════════════════════════════════════════════════════════════════════════╗
║                    MVT ПАТТЕРН (Model-View-Template)                      ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   MODEL     │       │    VIEW     │       │  TEMPLATE   │
│             │       │             │       │             │
│  Данные     │◄──────┤  Логика     │──────►│  HTML       │
│  (БД)       │       │  (Python)   │       │  (Дизайн)   │
│             │       │             │       │             │
│ models.py   │       │  views.py   │       │ .html       │
└─────────────┘       └─────────────┘       └─────────────┘
      ▲                      ▲                      │
      │                      │                      │
      │                      │                      ↓
      │                      │              ┌─────────────┐
      │                      │              │   Браузер   │
      │                      │              │             │
      │                      └──────────────┤  Запрос     │
      │                                     │  (URL)      │
      └─────────────────────────────────────┤             │
                                            └─────────────┘


╔═══════════════════════════════════════════════════════════════════════════╗
║                         БЕЗОПАСНОСТЬ                                      ║
╚═══════════════════════════════════════════════════════════════════════════╝

1. CSRF защита
   {% csrf_token %} → Уникальный токен в каждой форме
   
2. Валидация данных
   form.is_valid() → Проверка типов, длины, формата
   
3. Модерация
   is_approved=False → Отзывы не публикуются автоматически
   
4. ORM защита
   Django ORM → Защита от SQL-инъекций
   
5. XSS защита
   {{ variable }} → Автоматическое экранирование HTML


╔═══════════════════════════════════════════════════════════════════════════╗
║                    КЛЮЧЕВЫЕ КОНЦЕПЦИИ                                     ║
╚═══════════════════════════════════════════════════════════════════════════╝

ORM (Object-Relational Mapping)
├─ Review.objects.all()          → SELECT * FROM review
├─ Review.objects.filter(...)    → SELECT ... WHERE ...
├─ review.save()                 → INSERT или UPDATE
└─ review.delete()               → DELETE

QuerySet (набор объектов из БД)
├─ Ленивая загрузка (выполняется только при обращении)
├─ Можно фильтровать, сортировать, ограничивать
└─ Кэшируется автоматически

Миграции
├─ makemigrations → Создать инструкции
├─ migrate        → Применить к БД
└─ История изменений структуры БД

Формы Django
├─ Генерация HTML
├─ Валидация данных
├─ Очистка данных (cleaned_data)
└─ Защита от атак


═══════════════════════════════════════════════════════════════════════════

Эта схема поможет тебе объяснить работу системы на защите! 🎓
